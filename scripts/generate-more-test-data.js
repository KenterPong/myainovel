/**
 * 生成更多測試資料到資料庫
 */

const { Pool } = require('pg');
require('dotenv').config({ path: '.env.local', override: true });

async function generateMoreTestData() {
  console.log('📚 生成更多測試資料...');
  
  const pool = new Pool({
    user: 'postgres',
    host: 'localhost',
    database: 'myainovel',
    port: 5432,
    password: '1234',
    ssl: false
  });

  try {
    const client = await pool.connect();
    console.log('✅ 資料庫連線成功\n');

    // 清理現有測試資料
    console.log('🧹 清理現有測試資料...');
    await client.query('DELETE FROM chapters WHERE story_id::text LIKE \'550e8400-e29b-41d4-a716-446655440%\'');
    await client.query('DELETE FROM stories WHERE story_id::text LIKE \'550e8400-e29b-41d4-a716-446655440%\'');
    console.log('✅ 清理完成\n');

    // 測試故事資料
    const testStories = [
      {
        id: '550e8400-e29b-41d4-a716-446655440001',
        serial: 'A00001',
        title: '魔法學院的秘密',
        status: '投票中',
        chapters: [
          {
            number: '001',
            title: '第一章：入學的開始',
            content: `艾莉亞·星月站在古老的魔法學院大門前，手中緊握著那封神秘的信件。信封上燙金的字體在夕陽下閃閃發光，上面寫著：「致艾莉亞·星月，魔法學院誠摯邀請您加入我們的行列。」

她深吸一口氣，推開了那扇沉重的木門。門後是一個充滿魔法的世界——漂浮的書本在空中緩緩移動，各種顏色的光芒在走廊中閃爍，遠處傳來學生們練習咒語的聲音。

「歡迎來到魔法學院，親愛的。」一個溫和的聲音從身後傳來。艾莉亞轉過身，看到一位穿著深藍色長袍的老者正微笑著看著她。

「我是院長梅林，很高興見到你。」老者伸出手，「我知道你有很多疑問，但首先，讓我帶你參觀一下這個神奇的地方。」

他們穿過長長的走廊，經過了圖書館、實驗室、還有學生宿舍。每個地方都充滿了魔法的氣息，讓艾莉亞感到既興奮又緊張。

「這裡是我們的魔法實驗室，」院長指著一間充滿各種魔法器具的房間說，「學生們在這裡學習各種魔法技巧，從基礎的變形術到高級的召喚術。」

艾莉亞看到幾個學生正在練習漂浮術，他們專注地念著咒語，讓羽毛在空中優雅地舞動。她不禁想像自己也能掌握這些神奇的技能。

「但是，」院長的語氣突然變得嚴肅，「魔法學院也有它的危險。最近，我們發現了一些不尋常的現象——古老的封印開始鬆動，黑暗的力量正在蠢蠢欲動。」

艾莉亞感到一陣寒意，「什麼意思？」

「意思是，」院長看著她的眼睛，「你來到這裡不是偶然的。你的血統中蘊含著強大的魔法力量，而這個世界需要你來幫助我們對抗即將到來的黑暗。」

就在這時，遠處傳來一聲巨響，整個學院都震動起來。學生們驚慌失措地四處奔跑，而院長的表情變得更加嚴肅。

「看來時間比我們想像的還要緊迫，」他快速地說，「艾莉亞，你必須做出選擇。你可以選擇留在這裡，學習魔法，準備面對即將到來的挑戰；或者你可以離開，回到平凡的生活中。」

艾莉亞看著窗外，看到天空中出現了不祥的黑色雲朵，雷電在其中閃爍。她知道，這個選擇將改變她的一生。

「我...」她猶豫了一下，然後堅定地說，「我選擇留下。我要學習魔法，保護這個世界。」

院長露出了欣慰的笑容，「很好，那麼從明天開始，你將正式成為魔法學院的一員。但首先，我們需要為你準備一些東西。」

他從長袍中取出一根精美的魔杖，杖身是深色的木材，頂端鑲嵌著一顆閃閃發光的藍色寶石。

「這根魔杖曾經屬於一位偉大的魔法師，」院長將魔杖遞給艾莉亞，「現在它屬於你了。記住，魔杖只是工具，真正的力量來自於你的內心。」

艾莉亞接過魔杖，感到一股溫暖的力量從中傳來。她知道自己的人生從此將完全不同。

「現在，」院長說，「讓我們去見見你的同學們。他們都是來自世界各地的年輕魔法師，每個人都有自己獨特的天賦。」

他們走向學生宿舍，艾莉亞看到許多同齡的學生正在交流，分享彼此的魔法經驗。她感到既興奮又緊張，不知道自己在這個新世界中會遇到什麼樣的冒險。

「記住，」院長在離開前對她說，「魔法學院不僅僅是學習魔法的地方，它也是你的家。無論遇到什麼困難，都要相信自己的力量，相信你的朋友們。」

艾莉亞點點頭，看著院長離去的背影。她知道，從今天開始，她將踏上一段充滿魔法、友誼和冒險的旅程。

而這，只是開始。

遠處的鐘聲響起，宣告著晚餐時間的到來。艾莉亞深吸一口氣，走向學生們聚集的地方，準備開始她在魔法學院的新生活。

她不知道的是，在學院的深處，一個古老的預言正在應驗，而她的到來，正是這個預言中最重要的部分。

黑暗正在逼近，但光明也將隨之而來。艾莉亞·星月，這個名字將在魔法世界的歷史中留下深刻的印記。

而這一切，都將從明天開始。

當夜幕降臨，艾莉亞躺在宿舍的床上，看著窗外的星空，心中充滿了對未來的期待和對未知的恐懼。她知道，明天將是她在魔法學院的第一天，也是她人生新篇章的開始。

「願魔法與我同在，」她輕聲說道，然後閉上眼睛，準備迎接明天的挑戰。

在夢中，她看到了無數的魔法光芒，聽到了古老的咒語聲，感受到了來自內心深處的魔法力量。她知道，這不是夢，而是她真正的命運。

明天，她將正式成為一名魔法師。

明天，她將開始學習如何保護這個世界。

明天，她將發現自己真正的力量。

而這一切，都將從魔法學院開始。

艾莉亞·星月的魔法之旅，正式開始了。`,
            summary: '艾莉亞進入魔法學院，發現自己擁有強大的魔法力量，必須選擇是否留下學習魔法對抗即將到來的黑暗。',
            tags: ['魔法', '學院', '冒險', '奇幻', '成長']
          }
        ]
      },
      {
        id: '550e8400-e29b-41d4-a716-446655440002',
        serial: 'A00002',
        title: '星際探險家的日記',
        status: '撰寫中',
        chapters: [
          {
            number: '001',
            title: '第一章：未知星球的發現',
            content: `太空船「探索者號」在執行深空探索任務時，意外發現了一個從未被記錄的星球。船長傑克·雷諾茲透過觀測窗戶，看著這個被藍綠色大氣層包圍的神秘世界，心中充滿了興奮和不安。

「船長，」副官莎拉·陳的聲音從通訊器中傳來，「我們已經完成了初步掃描。這個星球的大氣成分與地球相似，但有一些未知的元素。重力約為地球的1.2倍，表面溫度適中。」

傑克點點頭，調整了觀測設備的焦距。透過高倍率望遠鏡，他可以看到星球表面有廣闊的海洋和陸地，還有一些看起來像是建築物的結構。

「這不可能，」科學官馬庫斯·威爾遜驚訝地說，「根據我們的資料庫，這個區域不應該有任何宜居星球。而且那些結構...它們看起來太規整了，不像是自然形成的。」

「你認為這是人工建造的？」傑克轉向馬庫斯。

「我不敢確定，但從幾何形狀來看，確實有這種可能。我們需要更近距離的觀察才能確定。」

就在這時，雷達系統突然發出警報聲。技術官艾米·羅德里格斯緊張地報告：「船長，我們偵測到有物體正在接近我們。速度很快，而且...它們的軌跡顯示它們是直接朝我們來的。」

傑克立即切換到防禦模式，「全體人員就戰鬥位置！準備應對可能的威脅！」

「等等，」莎拉突然說，「我認出了這個信號模式。這是...這是地球聯邦的識別信號！」

「什麼？」傑克驚訝地轉向螢幕，「但這不可能，我們是第一批到達這個區域的探險隊。」

螢幕上出現了一個模糊的影像，逐漸變得清晰。那是一個穿著聯邦制服的女性，看起來大約四十歲左右，臉上帶著友善但疲憊的笑容。

「探索者號，這裡是聯邦研究站『新希望』，」她的聲音透過通訊器傳來，「我是站長伊莉莎白·哈德森。我們已經在這裡等待你們很久了。」

傑克和船員們面面相覷，完全無法理解眼前的情況。根據他們的任務簡報，這個區域應該是完全未知的，不應該有任何人類的存在。

「哈德森站長，」傑克謹慎地回應，「我是探索者號船長傑克·雷諾茲。請解釋一下你們是如何到達這裡的，以及為什麼我們沒有收到任何關於這個研究站的報告。」

螢幕上的女性嘆了口氣，「這是一個很長的故事，雷諾茲船長。我們是在十五年前被派到這裡的，但由於某種原因，我們與地球失去了聯繫。我們一直在嘗試重新建立通訊，但所有的信號都被某種未知的干擾阻擋了。」

「十五年前？」馬庫斯驚訝地說，「但我們的資料顯示，聯邦直到五年前才開始探索這個區域。」

「這就是問題所在，」哈德森站長說，「我們發現這個星球上有一種特殊的礦物，它能夠影響時空結構。我們的研究可能改變了歷史的進程，或者創造了一個平行宇宙。」

傑克感到一陣寒意，「你是說，我們可能不在我們以為的宇宙中？」

「這正是我們想要與你們討論的，」哈德森站長說，「我們需要你們的幫助來解決這個問題，否則我們可能永遠無法回到原來的時空。」

「我們需要更多資訊，」傑克說，「你們能提供詳細的技術資料嗎？」

「當然，」哈德森站長說，「但首先，我們建議你們降落到星球表面。在太空中討論這些事情不太安全，而且我們有一些重要的發現需要與你們分享。」

傑克看了看他的船員們，每個人的臉上都寫滿了困惑和好奇。這是一個他們從未預料到的情況，但同時也是一個可能改變人類歷史的機會。

「我們會考慮你們的建議，」傑克說，「但首先，我們需要確保這不是一個陷阱。」

「我完全理解你們的謹慎，」哈德森站長說，「我們可以發送一些技術資料給你們，讓你們自己判斷。同時，我們也會提供降落座標和導航資訊。」

「謝謝，」傑克說，「我們會仔細研究這些資料，然後做出決定。」

通訊結束後，探索者號的船員們陷入了沉默。每個人都在思考這個令人震驚的發現可能帶來的影響。

「如果他們說的是真的，」莎拉打破了沉默，「那麼我們可能發現了人類歷史上最重要的科學突破。」

「但也可能是最危險的，」馬庫斯補充道，「如果時空真的被改變了，我們不知道會發生什麼後果。」

傑克看著窗外那個神秘的星球，心中充滿了複雜的情緒。作為一名探險家，他渴望探索未知；但作為船長，他必須為船員的安全負責。

「我們需要時間來分析這些資料，」他最終說道，「但在那之前，我們要保持警惕。這個發現可能改變一切，但我們必須確保我們準備好應對任何可能的後果。」

探索者號繼續在太空中漂浮，船員們開始分析從研究站接收到的資料。他們不知道的是，這個決定將帶領他們進入一個充滿危險和奇蹟的冒險，而這只是開始。

在星球的表面，研究站的科學家們也在緊張地等待著。他們知道，探索者號的到來可能是他們回到原來的時空的唯一機會，但同時也可能帶來無法預料的災難。

兩個世界的命運，即將在這個神秘的星球上交匯。`,
            summary: '太空船探索者號發現未知星球，遇到十五年前失聯的聯邦研究站，發現時空可能被改變。',
            tags: ['科幻', '太空', '時空', '探險', '懸疑']
          }
        ]
      },
      {
        id: '550e8400-e29b-41d4-a716-446655440003',
        serial: 'A00003',
        title: '古代王國的復活',
        status: '投票中',
        chapters: [
          {
            number: '001',
            title: '第一章：沉睡的王者',
            content: `考古學家艾莉絲·溫斯頓站在古埃及金字塔的深處，手中的火炬在古老的石牆上投下搖曳的光影。她已經在這個被遺忘的墓室中探索了三天，尋找傳說中法老阿蒙霍特普四世的秘密陵墓。

「教授，」她的助手湯姆·哈里森的聲音從通訊器中傳來，帶著明顯的興奮，「我們發現了一些東西。在東側的牆壁上，有一個隱藏的機關。」

艾莉絲立即走向指示的位置，仔細檢查石牆上的每一塊石頭。經過幾分鐘的仔細觀察，她發現了一塊與其他石頭略有不同的石塊，上面刻著古老的象形文字。

「這是...」她輕聲說道，手指輕撫著石頭上的文字，「『只有真正的繼承者才能喚醒沉睡的王者』。」

「什麼意思？」湯姆問道。

「這意味著我們找到了傳說中的法老陵墓，」艾莉絲解釋道，「但同時也意味著我們可能觸發了某種古老的詛咒。」

她小心地按下那塊石頭，整個墓室突然開始震動。石牆緩緩分開，露出一個通往更深處的通道。通道兩側的牆壁上刻滿了精美的壁畫，描繪著古埃及神話中的各種場景。

「太不可思議了，」湯姆驚嘆道，「這些壁畫保存得如此完好，就像是昨天才畫的一樣。」

艾莉絲點點頭，但她的注意力被通道盡頭的一扇巨大的石門吸引。石門上刻著複雜的象形文字和神秘的符號，中央有一個圓形的凹槽。

「這需要一把特殊的鑰匙，」她說，「但我們沒有。」

就在這時，她注意到石門旁邊有一個小型的祭壇，上面放著一個精美的金盒子。她小心地打開盒子，裡面是一把古老的鑰匙，鑰匙的形狀與石門上的凹槽完全吻合。

「這太巧合了，」湯姆說，「就像是有人故意放在這裡等我們來拿。」

艾莉絲拿起鑰匙，感到一股奇異的能量從中傳來。她將鑰匙插入石門的凹槽中，輕輕轉動。石門緩緩打開，露出一個巨大的墓室。

墓室中央放著一個華麗的石棺，石棺上刻著法老阿蒙霍特普四世的名字。但更令人驚訝的是，石棺周圍站著四個巨大的石像，每個石像都手持不同的武器，看起來像是守護者。

「這些石像...」艾莉絲走近其中一個石像，仔細觀察，「它們的雕刻技術非常先進，不像是那個時代的產物。」

突然，其中一個石像的眼睛亮起了藍色的光芒。艾莉絲和湯姆嚇得後退幾步，但石像並沒有攻擊他們，而是緩緩轉向石棺。

「歡迎，繼承者，」一個低沉的聲音在墓室中迴響，「你們的到來預示著古老王國的復活。」

「誰在說話？」湯姆緊張地問道。

「我是阿蒙霍特普四世的靈魂，」聲音回答，「我在這裡等待了三千多年，等待真正的繼承者到來。」

「我們不是什麼繼承者，」艾莉絲說，「我們只是考古學家。」

「不，」聲音堅定地說，「你們的血統中流淌著古埃及王室的血液。你們的祖先曾經統治過這片土地，現在是時候恢復你們的榮耀了。」

艾莉絲感到一陣眩暈，腦海中突然出現了許多不屬於她的記憶。她看到了古埃及的輝煌時代，看到了法老們的宮殿，看到了人民對王室的敬仰。

「這不可能，」她搖搖頭，試圖擺脫這些幻象，「我是英國人，我的祖先不可能與古埃及有關。」

「血統的傳承超越了國界和時間，」聲音解釋道，「你們的祖先在古埃及滅亡後，帶著王室的秘密逃到了世界各地。現在，是時候讓這些秘密重見天日了。」

石棺的蓋子緩緩打開，裡面躺著一具保存完好的木乃伊。但這不是普通的木乃伊，它的身上穿著華麗的法老服裝，手中握著一根權杖。

「這根權杖擁有復活死者的力量，」聲音說，「但只有真正的繼承者才能使用它。如果你們願意接受這個使命，我可以教你們如何使用這股力量。」

艾莉絲看著權杖，心中充滿了矛盾。作為一名科學家，她不相信超自然現象；但作為一名考古學家，她渴望了解古代文明的秘密。

「如果我們接受這個使命，會發生什麼？」她問道。

「你們將成為新時代的法老，」聲音回答，「你們將重建古埃及的輝煌，帶領人類進入一個新的黃金時代。但同時，你們也將面臨來自黑暗勢力的挑戰。」

「黑暗勢力？」湯姆問道。

「那些曾經毀滅古埃及的邪惡力量，」聲音解釋道，「它們一直在等待機會重新崛起。只有真正的繼承者才能阻止它們。」

艾莉絲和湯姆面面相覷，不知道該如何選擇。這個發現可能改變他們的一生，但也可能帶來無法預料的危險。

「我們需要時間考慮，」艾莉絲最終說道。

「當然，」聲音說，「但記住，時間不等人。黑暗勢力已經開始行動，如果你們不盡快做出決定，可能就太遲了。」

就在這時，墓室突然開始震動，遠處傳來爆炸聲。艾莉絲和湯姆感到地面在搖晃，石牆上出現了裂縫。

「發生了什麼？」湯姆驚慌地問道。

「他們來了，」聲音變得緊張，「黑暗勢力的爪牙已經找到了這裡。你們必須立即做出決定，否則我們都將被毀滅。」

艾莉絲看著手中的權杖，心中做出了決定。她舉起權杖，大聲說道：「我接受這個使命！我將成為新時代的法老，重建古埃及的輝煌！」

權杖突然發出耀眼的光芒，整個墓室被金色的光芒籠罩。艾莉絲感到一股強大的力量湧入她的身體，她的眼睛變成了古埃及法老特有的金色。

「很好，」聲音滿意地說，「現在，讓我們離開這裡，開始你們的新使命。」

石棺緩緩升起，露出一個通往地下的通道。艾莉絲和湯姆跟著法老的靈魂進入通道，開始了他們的新冒險。

在他們身後，古埃及的守護者們重新復活，準備保護他們的新主人。古老的王國即將復活，而艾莉絲·溫斯頓將成為這個新時代的領導者。

但她也知道，更大的挑戰正在等待著她。黑暗勢力不會輕易放棄，她必須準備好面對即將到來的戰爭。

古埃及的復活，正式開始了。`,
            summary: '考古學家艾莉絲發現法老陵墓，發現自己是古埃及王室後裔，必須選擇是否接受復活古埃及的使命。',
            tags: ['古埃及', '考古', '超自然', '冒險', '歷史']
          }
        ]
      }
    ];

    // 建立故事和章節
    for (const story of testStories) {
      console.log(`📚 建立故事: ${story.title}`);
      
      // 建立故事
      await client.query(`
        INSERT INTO stories (story_id, story_serial, title, status, origin_voting_start_date)
        VALUES ($1, $2, $3, $4, NOW())
      `, [story.id, story.serial, story.title, story.status]);

      // 建立章節
      for (const chapter of story.chapters) {
        console.log(`  📖 建立章節: ${chapter.title}`);
        
        const chapterResult = await client.query(`
          INSERT INTO chapters (
            story_id, chapter_number, title, full_text, summary,
            voting_status, voting_deadline, voting_options, tags
          ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
          RETURNING chapter_id
        `, [
          story.id,
          chapter.number,
          chapter.title,
          chapter.content,
          chapter.summary,
          '進行中',
          new Date(Date.now() + 24 * 60 * 60 * 1000), // 24小時後截止
          JSON.stringify({
            options: [
              { id: 'A', content: '選擇勇敢面對挑戰', description: '勇敢地接受使命，準備面對未知的危險' },
              { id: 'B', content: '選擇謹慎觀察', description: '謹慎地觀察情況，不急於做決定' },
              { id: 'C', content: '選擇尋求幫助', description: '尋求更多資訊和幫助，不獨自承擔責任' }
            ],
            total_votes: 0
          }),
          JSON.stringify(chapter.tags)
        ]);

        const chapterId = chapterResult.rows[0].chapter_id;
        console.log(`    ✅ 章節建立成功 (ID: ${chapterId})`);
      }
    }

    // 驗證結果
    console.log('\n📊 驗證結果:');
    const storiesResult = await client.query(`
      SELECT s.title, s.status, COUNT(c.chapter_id) as chapter_count
      FROM stories s
      LEFT JOIN chapters c ON s.story_id = c.story_id
      WHERE s.story_id::text LIKE '550e8400-e29b-41d4-a716-446655440%'
      GROUP BY s.story_id, s.title, s.status
      ORDER BY s.story_serial
    `);

    storiesResult.rows.forEach(row => {
      console.log(`  - ${row.title} (${row.status}) - ${row.chapter_count} 章節`);
    });

    // 檢查章節內容長度
    const chaptersResult = await client.query(`
      SELECT c.title, LENGTH(c.full_text) as content_length, s.title as story_title
      FROM chapters c
      JOIN stories s ON c.story_id = s.story_id
      WHERE s.story_id::text LIKE '550e8400-e29b-41d4-a716-446655440%'
      ORDER BY s.story_serial, c.chapter_number
    `);

    console.log('\n📝 章節內容長度:');
    chaptersResult.rows.forEach(row => {
      console.log(`  - ${row.story_title}: ${row.title} (${row.content_length} 字元)`);
    });

    client.release();
    console.log('\n✅ 測試資料生成完成！');
    
  } catch (error) {
    console.error('❌ 錯誤:', error.message);
  } finally {
    await pool.end();
  }
}

// 執行函數
generateMoreTestData().catch(console.error);
